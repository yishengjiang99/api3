<!DOCTYPE html>
<html>

<head>
	<title>Spotify Premium Plasyer</title>
	<link href="//cdn.muicss.com/mui-0.10.2/css/mui.min.css" rel="stylesheet" type="text/css" />
	<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
		crossorigin />
	<!-- <script src="/spotify/bundle.js"></script> -->
	<style>
		body {

			background-color: black;
			color: white;
		}

		.mui-container {
			padding-top: 10em;
			display: grid;
			grid-gap: 10px;
			color: white;
		}

		.sidenav {
			grid-column: 1;
			grid-row: 1 / 2;
			background-color: #333333;
		}

		.footer {
			grid-column: 2/4;
			grid-row: 3;
			background-color: #333333;
		}

		.main {
			grid-column: 2 / 4;
			grid-row: 1/3;
			background-color: #555555;
			max-height: 800px;
			overflow-y: scroll;
		}

		.nowplaying {
			grid-column: 1;
			grid-row: 2/3;
			background-color: #555555;
		}

		.song-controls {
			display: grid;
			height: 50px;
			width: 300px;
			grid-gap: 10px;
		}

		.song-controls .rewind {
			grid-column: 1/2;
		}

		.song-controls .play-btn {
			grid-column: 2/3;
		}

		.song-controls .pause-btn {
			grid-column: 2/3;
			display: none;
		}

		.song-controls .next-song {
			grid-column: "3/4";
		}

		#nexttracks {
			position: "absolute";
			right: "3em";
			width: 200;
			height: "100%";
			overflow-y: "scroll";
		}

		.song-player-container {
			position: relative;
			width: 100%;
			height: 100%;
		}

		.song-controls button {
			cursor: pointer;
		}
	</style>
	<script src="/spotify/bundle.js"></script>
</head>

<body>
		<!--BREAK-->
<script>
        window.onSpotifyWebPlaybackSDKReady = () => {
            log("loading");
            window.webplayer = new Spotify.Player({
                name: "Wgr",
                getOAuthToken: (cb) => cb(window.access_token),
            });
            window.webplayer.addListener("initialization_error", ({message}) => {
                console.log(message);
            });
            window.webplayer.addListener("not_ready", (e) => {
                  console.log("not read");
            });

            window.webplayer.addListener("ready", (e) => {
			  window.spotifyDeviceId = e.device_id;
			                  window.webplayer.connect();

			})
		});


                document.getElementById("play").style.display = "block";

                window.webplayer.addListener("initialization_error", (e) => reject(e));
                window.webplayer.addListener(
                    "account_error",
                    (e) => log("account not prenium") && reject(e)
                );

                window.webplayer.connect();
                controls.play.onclick = () => window.webplayer.resume();
                controls.stop.onclick = () => window.webplayer.pause();
                controls.ff.onclick = () => window.webplayer.nextTrack();
                controls.rewind.onclick = () => window.webplayer.previousTrack();
                resolve();
            });
            window.webplayer.addListener("player_state_changed", (e) => {
                console.log(e);
                if (e.track_window.current_track) {
                    currentTrackId = e.track_window.current_track.id;
                    renderNowPlaying(e.track_window.current_track.album.images[0].url,
                        [],
                        e.track_window.current_track.name,
                        e.track_window.current_track.artists
                        .map((a) => a.name)
                        .join(", "));
  
                }
                if(e.track_window.next_tracks){
                    $("#nexttracks").innerHTML = e.track_window.next_tracks.map(
                        track=> "<li>"+track.name+"</li>"
                    ).join("");
                }
                let timer;

                if (e.paused === false) {
                    if (timer) cancelAnimationFrame(timer);
                    var startedAt = e.position;
                    var start = new Date();
                    controls.play.style.display = "none";
                    controls.stop.style.display = "block";

                    const positionUI = $("#player .position");
                    const durationUI = $("#player .duration");

                    const progress = document.getElementById("progress");
                    durationUI.innerHTML = ms_to_mm_ss(e.duration);
                    progress.max = e.duration;
                    function updateTimer() {
                        var elapsed = new Date().getTime() - start.getTime();
                        positionUI.innerHTML = ms_to_mm_ss(e.position + elapsed);
                        var played = startedAt + elapsed;
                        progress.value = played;
                        timer = requestAnimationFrame(updateTimer);
                    }

                    updateTimer();
                } else {
                    if (timer!==null) {
                        cancelAnimationFrame(timer);
                        timer = null;
                    }
                    controls.play.style.display = "block";
                    controls.stop.style.display = "none";
                }
            });
            window.webplayer.connect();
        };

        var script = document.createElement("script");
        script.type = "text/javascript";
        script.src = "https://sdk.scdn.co/spotify-player.js";
        document.getElementsByTagName("head")[0].appendChild(script);
    });
}</script>
</body>

</html>